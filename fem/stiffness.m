%% 单元刚度矩阵计算方法一
function k=stiffness(E,NU,h,x1,y1,x2,y2,x3,y3,x4,y4)
%输入参数：弹性模量、泊松比、单元四点坐标；输出参数：单元刚度矩阵
syms s t;
a = (y1*(s-1)+y2*(-1-s)+y3*(1+s)+y4*(1-s))/4;
b = (y1*(t-1)+y2*(1-t)+y3*(1+t)+y4*(-1-t))/4;
c = (x1*(t-1)+x2*(1-t)+x3*(1+t)+x4*(-1-t))/4;
d = (x1*(s-1)+x2*(-1-s)+x3*(1+s)+x4*(1-s))/4;
B1 = [a*(t-1)/4-b*(s-1)/4 0 ; 0 c*(s-1)/4-d*(t-1)/4 ;
    c*(s-1)/4-d*(t-1)/4 a*(t-1)/4-b*(s-1)/4];
B2 = [a*(1-t)/4-b*(-1-s)/4 0 ; 0 c*(-1-s)/4-d*(1-t)/4 ;
    c*(-1-s)/4-d*(1-t)/4 a*(1-t)/4-b*(-1-s)/4];
B3 = [a*(t+1)/4-b*(s+1)/4 0 ; 0 c*(s+1)/4-d*(t+1)/4 ;
    c*(s+1)/4-d*(t+1)/4 a*(t+1)/4-b*(s+1)/4];
B4 = [a*(-1-t)/4-b*(1-s)/4 0 ; 0 c*(1-s)/4-d*(-1-t)/4 ;
    c*(1-s)/4-d*(-1-t)/4 a*(-1-t)/4-b*(1-s)/4];
Bfirst = [B1 B2 B3 B4];
Jfirst = [0 1-t t-s s-1 ; t-1 0 s+1 -s-t ;
    s-t -s-1 0 t+1 ; 1-s s+t -t-1 0];
J = [x1 x2 x3 x4]*Jfirst*[y1 ; y2 ; y3 ; y4]/8;
B = Bfirst/J;
D = (E/(1-NU*NU))*[1, NU, 0 ; NU, 1, 0 ; 0, 0, (1-NU)/2];
BD = J*transpose(B)*D*B;

%% 高斯积分（9个高斯积分点及其权重）
    
 GUASS9_1(1)=-0.774596669241483;
 GUASS9_2(1)=-0.774596669241483;
 GUASS9_1(2)=-0.774596669241483;
 GUASS9_2(2)=0;
 GUASS9_1(3)=-0.774596669241483;
 GUASS9_2(3)=0.774596669241483;
 GUASS9_1(4)=0;
 GUASS9_2(4)=0.774596669241483;
 GUASS9_1(5)=0.774596669241483;
 GUASS9_2(5)=0.774596669241483;
 GUASS9_1(6)=0.774596669241483;
 GUASS9_2(6)=0;
 GUASS9_1(7)=0.774596669241483;
 GUASS9_2(7)=-0.774596669241483;
 GUASS9_1(8)=0;
 GUASS9_2(8)=-0.774596669241483;
 GUASS9_1(9)=0;
 GUASS9_2(9)=0;
 WEIGHT9(1)=0.308641975308642;
 WEIGHT9(2)=0.493827160493828;
 WEIGHT9(3)=0.308641975308642;
 WEIGHT9(4)=0.493827160493828;
 WEIGHT9(5)=0.308641975308642;
 WEIGHT9(6)=0.493827160493828;
 WEIGHT9(7)=0.308641975308642;
 WEIGHT9(8)=0.493827160493828;
 WEIGHT9(9)=0.790123456790124;
 
 k=zeros(8,8);
for i=1:9
    s=GUASS9_1(i);t=GUASS9_2(i);
    a1=subs(BD);
    k=k+WEIGHT9(i)*a1;
end
k=h*k;
k=double(k);
end
